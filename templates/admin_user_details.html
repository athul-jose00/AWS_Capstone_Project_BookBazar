{% extends 'base.html' %}
{% block title %}User Details | Admin Dashboard | BookBazaar{% endblock %}
{% block body_class %}admin-page{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="/static/css/dashboard.css" />
<link rel="stylesheet" href="/static/css/admin_dashboard.css" />
{% endblock %}
{% block header %}
<header class="site-header">
  <a class="logo" href="/"> <i class="fas fa-book-open"></i> BookBazaar </a>
  <nav class="nav-actions">
    <span class="nav-link" style="color: var(--accent-teal)">
      <i class="fas fa-user-shield"></i> {{ user.name }}
    </span>
    <a href="{{ url_for('logout') }}" class="btn btn-primary btn-nav">
      <i class="fas fa-sign-out-alt"></i> Logout
    </a>
  </nav>
</header>
{% endblock %}
{% block content %}
<div class="dashboard-layout">
  {% include '_admin_sidebar.html' %}
  <div class="dashboard-container admin-dashboard">
    <div class="profile-panel">
      <div class="admin-header">
        <h1><i class="fas fa-user-circle"></i> User Details</h1>
        <p class="admin-subtitle">
          <a href="{{ url_for('admin_users') }}">&larr; Back to Users</a>
        </p>
      </div>

      <div class="admin-section">
        <div class="detail-card">
          <h2>Account Information</h2>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Email</label>
              <p>{{ user_info.email }}</p>
            </div>
            <div class="detail-item">
              <label>Name</label>
              <p>{{ user_info.name }}</p>
            </div>
            <div class="detail-item">
              <label>Role</label>
              <p>
                <span class="badge badge-{{ user_info.role }}">
                  {% if user_info.role == 'seller' %}
                    <i class="fas fa-store"></i> Seller
                  {% else %}
                    <i class="fas fa-user"></i> Customer
                  {% endif %}
                </span>
              </p>
            </div>
          </div>
        </div>

        {% if user_info.role == 'customer' %}
        <div class="detail-card">
          <h2><i class="fas fa-shopping-cart"></i> Orders ({{ user_info.orders|length }})</h2>
          {% if user_info.orders %}
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Items</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                {% for order in user_info.orders %}
                <tr>
                  <td>{{ order.id }}</td>
                  <td><span class="badge badge-{{ order.status|lower }}">{{ order.status }}</span></td>
                  <td>${{ "%.2f"|format(order.total) }}</td>
                  <td>{{ order.items|length }}</td>
                  <td>{{ order.created_at[:10] if order.created_at else 'N/A' }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p class="text-muted">No orders found for this user.</p>
          {% endif %}
        </div>

        <div class="detail-card">
          <h2><i class="fas fa-heart"></i> Wishlist ({{ user_info.wishlist|length }})</h2>
          {% if user_info.wishlist %}
          <p>User has {{ user_info.wishlist|length }} items in wishlist.</p>
          {% else %}
          <p class="text-muted">Wishlist is empty.</p>
          {% endif %}
        </div>

        <div class="detail-card">
          <h2><i class="fas fa-shopping-bag"></i> Cart ({{ user_info.cart|length }})</h2>
          {% if user_info.cart %}
          <p>User has {{ user_info.cart|length }} items in cart.</p>
          {% else %}
          <p class="text-muted">Cart is empty.</p>
          {% endif %}
        </div>
        {% endif %}

        {% if user_info.role == 'seller' %}
        <div class="detail-card">
          <h2><i class="fas fa-book"></i> Books Listed ({{ user_info.books|length }})</h2>
          {% if user_info.books %}
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Author</th>
                  <th>Price</th>
                  <th>Stock</th>
                  <th>Genre</th>
                </tr>
              </thead>
              <tbody>
                {% for book in user_info.books %}
                <tr>
                  <td>{{ book.title }}</td>
                  <td>{{ book.author }}</td>
                  <td>${{ "%.2f"|format(book.price) }}</td>
                  <td>{{ book.stock }}</td>
                  <td>{{ book.genre }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p class="text-muted">No books listed by this seller.</p>
          {% endif %}
        </div>

        <div class="detail-card">
          <h2><i class="fas fa-inbox"></i> Received Orders ({{ user_info.received_orders|length }})</h2>
          {% if user_info.received_orders %}
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Items</th>
                </tr>
              </thead>
              <tbody>
                {% for order in user_info.received_orders %}
                <tr>
                  <td>{{ order.id }}</td>
                  <td><span class="badge badge-{{ order.status|lower }}">{{ order.status }}</span></td>
                  <td>${{ "%.2f"|format(order.total) }}</td>
                  <td>{{ order.items|length }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p class="text-muted">No orders received yet.</p>
          {% endif %}
        </div>
        {% endif %}

        <div class="form-actions">
          <form method="POST" action="{{ url_for('admin_delete_user', email=user_email) }}" onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
            <button type="submit" class="btn btn-danger btn-lg">
              <i class="fas fa-trash"></i> Delete User
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
